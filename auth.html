<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>MusicsAura â€” Login & Signup</title>

  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">

  <!-- FIREBASE IMPORTMAP -->
  <script type="importmap">
  {
    "imports": {
      "firebase/app": "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js",
      "firebase/auth": "https://www.gstatic.com/firebasejs/9.23.0/firebase-auth.js",
      "firebase/firestore": "https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js"
    }
  }
  </script>

  <style>
    :root{
      --bg-dark:#0a0a14; --bg-purple:#1a0b3d; --accent:#8b3dff; --accent-light:#c77dff;
      --glass:rgba(255,255,255,0.08); --glass-border:rgba(255,255,255,0.15);
      --text:#e2e8f0; --muted:#94a3b8; --danger:#ff6b6b; --success:#4ade80;
    }
    *{box-sizing:border-box;margin:0;padding:0}
    html,body{min-height:100vh;font-family:'Inter',sans-serif;background:#0a0a14;color:var(--text);overflow-x:hidden}
    body{position:relative}
    
    /* Animated gradient background */
    .bg{position:absolute;inset:0;min-height:100vh;z-index:0;background:linear-gradient(135deg,var(--bg-dark) 0%,#120820 50%,var(--bg-purple) 100%);background-size:400% 400%;animation:bgFlow 20s ease infinite}
    @keyframes bgFlow{0%,100%{background-position:0% 50%}50%{background-position:100% 50%}}

    /* Glowing orbs */
    .orbs{position:absolute;inset:0;min-height:100vh;z-index:1;pointer-events:none}
    .orb{position:absolute;border-radius:50%;filter:blur(100px);opacity:0.4}
    .orb1{width:500px;height:500px;background:radial-gradient(circle,rgba(139,61,255,0.6),transparent);top:5%;left:5%;animation:float1 20s ease-in-out infinite}
    .orb2{width:400px;height:400px;background:radial-gradient(circle,rgba(74,144,226,0.5),transparent);bottom:10%;right:10%;animation:float2 25s ease-in-out infinite}
    @keyframes float1{0%,100%{transform:translate(0,0)}50%{transform:translate(80px,-60px)}}
    @keyframes float2{0%,100%{transform:translate(0,0)}50%{transform:translate(-70px,50px)}}

    /* Stars */
    .stars{position:absolute;inset:0;min-height:100vh;z-index:2;pointer-events:none}
    .star{position:absolute;width:2px;height:2px;background:#fff;border-radius:50%;box-shadow:0 0 3px #fff,0 0 6px #fff,0 0 10px rgba(139,61,255,0.8);animation:starTwinkle 2s ease-in-out infinite}
    @keyframes starTwinkle{0%,100%{opacity:0.4;transform:scale(0.8)}50%{opacity:1;transform:scale(1.3)}}

    /* Floating music notes */
    .notes{position:absolute;inset:0;min-height:100vh;z-index:2;pointer-events:none}
    .note{position:absolute;font-size:28px;color:var(--accent);opacity:0;animation:noteFloat 15s linear infinite;text-shadow:0 0 20px var(--accent),0 0 40px rgba(139,61,255,0.5)}
    @keyframes noteFloat{
      0%{transform:translateY(110vh) rotate(0deg);opacity:0}
      10%{opacity:0.8}
      90%{opacity:0.8}
      100%{transform:translateY(-10vh) rotate(720deg);opacity:0}
    }

    /* Container */
    .container{position:relative;z-index:10;display:flex;min-height:100vh;max-width:1400px;margin:auto;padding:40px;gap:80px;align-items:center;justify-content:center}
    @media (max-width:1000px){.container{flex-direction:column;gap:40px;padding:40px 20px}}
    @media (max-width:600px){.container{padding:30px 15px}}

    /* Auth side */
    .auth-side{max-width:460px;width:100%}
    .card{background:var(--glass);border-radius:32px;border:1px solid var(--glass-border);backdrop-filter:blur(40px);box-shadow:0 60px 120px rgba(0,0,0,0.9),inset 0 0 80px rgba(139,61,255,0.08),0 0 100px rgba(139,61,255,0.3);padding:48px 40px;animation:cardPop 0.8s cubic-bezier(0.34,1.56,0.64,1) both;position:relative;overflow:hidden}
    .card::before{content:'';position:absolute;inset:0;background:linear-gradient(135deg,rgba(139,61,255,0.1),transparent);opacity:0;transition:opacity 0.5s}
    .card:hover::before{opacity:1}
    @keyframes cardPop{from{opacity:0;transform:scale(0.8) translateY(40px)}to{opacity:1;transform:scale(1) translateY(0)}}

    .logo{text-align:center;margin-bottom:40px}
    .logo-icon{font-size:72px;margin-bottom:12px;animation:logoSpin 4s ease-in-out infinite;filter:drop-shadow(0 0 40px var(--accent))}
    @keyframes logoSpin{0%,100%{transform:rotate(-10deg) scale(1)}50%{transform:rotate(10deg) scale(1.1)}}

    h1{font-size:36px;font-weight:700;margin-bottom:8px;text-align:center;background:linear-gradient(135deg,#8b3dff 0%,#c77dff 50%,#8b3dff 100%);background-size:200% 200%;-webkit-background-clip:text;-webkit-text-fill-color:transparent;animation:textShimmer 3s ease-in-out infinite}
    @keyframes textShimmer{0%,100%{background-position:0% 50%}50%{background-position:100% 50%}}

    .subtitle{text-align:center;color:var(--muted);font-size:16px;margin-bottom:36px}

    .tabs{display:flex;gap:8px;margin-bottom:32px;background:rgba(255,255,255,0.05);padding:6px;border-radius:16px}
    .tab{flex:1;padding:12px;border:none;background:transparent;color:var(--muted);font-size:15px;font-weight:600;border-radius:12px;cursor:pointer;transition:all 0.3s}
    .tab.active{background:linear-gradient(135deg,var(--accent),var(--accent-light));color:#fff;box-shadow:0 8px 24px rgba(139,61,255,0.4)}

    .form-section{display:none;animation:fadeSlideIn 0.5s ease both}
    .form-section.active{display:block}
    @keyframes fadeSlideIn{from{opacity:0;transform:translateY(20px)}to{opacity:1;transform:translateY(0)}}

    .form-row{margin-bottom:20px}
    label{display:block;margin-bottom:8px;font-size:14px;font-weight:500;color:var(--muted)}
    .input-wrap{position:relative}
    input{width:100%;padding:14px 16px 14px 48px;border-radius:14px;border:1px solid rgba(255,255,255,0.15);background:rgba(255,255,255,0.06);color:#fff;font-size:16px;outline:none;transition:all 0.3s}
    input:focus{border-color:var(--accent);box-shadow:0 0 0 4px rgba(139,61,255,0.2),inset 0 2px 8px rgba(0,0,0,0.2);transform:translateY(-2px)}
    input::placeholder{color:rgba(255,255,255,0.4)}
    .icon{position:absolute;left:16px;top:50%;transform:translateY(-50%);color:rgba(255,255,255,0.5);font-size:20px;transition:color 0.3s}
    input:focus ~ .icon{color:var(--accent)}

    .btn{width:100%;padding:16px;border:none;border-radius:14px;font-size:17px;font-weight:600;cursor:pointer;transition:all 0.3s;position:relative;overflow:hidden;margin-top:8px}
    .btn-primary{background:linear-gradient(135deg,var(--accent),var(--accent-light));color:#fff;box-shadow:0 12px 32px rgba(139,61,255,0.4)}
    .btn-primary:hover{transform:translateY(-3px);box-shadow:0 16px 40px rgba(139,61,255,0.6)}
    .btn-primary::before{content:'';position:absolute;inset:0;background:linear-gradient(135deg,rgba(255,255,255,0.3),transparent);opacity:0;transition:opacity 0.3s}
    .btn-primary:hover::before{opacity:1}

    .divider{display:flex;align-items:center;gap:16px;margin:24px 0;color:var(--muted);font-size:14px}
    .divider::before,.divider::after{content:'';flex:1;height:1px;background:rgba(255,255,255,0.1)}

    .google-btn{width:100%;padding:14px;border:1px solid rgba(255,255,255,0.2);border-radius:14px;background:rgba(255,255,255,0.08);color:#fff;font-size:16px;font-weight:600;display:flex;align-items:center;justify-content:center;gap:12px;cursor:pointer;transition:all 0.3s}
    .google-btn:hover{background:rgba(255,255,255,0.12);border-color:var(--accent);transform:translateY(-2px);box-shadow:0 8px 24px rgba(139,61,255,0.3)}
    .google-btn img{width:20px;height:20px}

    .forgot-link{display:block;text-align:right;margin-top:-8px;margin-bottom:16px;color:var(--accent);font-size:14px;text-decoration:none;transition:all 0.3s}
    .forgot-link:hover{color:var(--accent-light);text-decoration:underline}

    /* Welcome side */
    .welcome{max-width:600px;animation:fadeInRight 1s ease both;animation-delay:0.3s}
    @media (max-width:1000px){.welcome{text-align:center}}
    @media (max-width:600px){.welcome{display:none}}
    .welcome h2{font-size:56px;font-weight:700;margin-bottom:24px;line-height:1.1;background:linear-gradient(135deg,#fff,var(--accent-light));-webkit-background-clip:text;-webkit-text-fill-color:transparent}
    .welcome p{font-size:18px;line-height:1.8;color:rgba(255,255,255,0.8)}
    .welcome strong{color:var(--accent-light)}
    @keyframes fadeInRight{from{opacity:0;transform:translateX(-40px)}to{opacity:1;transform:translateX(0)}}

    /* Loader */
    .loader{position:fixed;inset:0;background:rgba(10,10,20,0.98);backdrop-filter:blur(30px);z-index:9999;display:none;align-items:center;justify-content:center;flex-direction:column}
    .loader.active{display:flex}
    .bars{display:flex;gap:10px;height:80px;align-items:flex-end;margin-bottom:24px}
    .bar{width:12px;background:linear-gradient(to top,var(--accent),var(--accent-light));border-radius:6px;animation:barPulse 1.2s ease-in-out infinite}
    .bar:nth-child(1){animation-delay:0s}
    .bar:nth-child(2){animation-delay:0.15s}
    .bar:nth-child(3){animation-delay:0.3s}
    .bar:nth-child(4){animation-delay:0.45s}
    @keyframes barPulse{0%,100%{height:30%}50%{height:100%}}
    .loader-text{font-size:18px;color:var(--text);letter-spacing:1.5px;animation:pulse 1.5s ease-in-out infinite}
    @keyframes pulse{0%,100%{opacity:0.5}50%{opacity:1}}

    /* Messages */
    .msg{margin-top:16px;padding:14px 18px;border-radius:12px;font-size:15px;text-align:center;animation:slideDown 0.4s ease;line-height:1.6}
    .error{background:rgba(255,107,107,0.2);border:1px solid rgba(255,107,107,0.4);color:#ff9999;font-weight:500}
    .success{background:rgba(74,222,128,0.2);border:1px solid rgba(74,222,128,0.4);color:#6ee7b7;font-weight:500}
    @keyframes slideDown{from{opacity:0;transform:translateY(-10px)}to{opacity:1;transform:translateY(0)}}

    /* Toast notification */
    .toast{position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);z-index:99999;background:rgba(10,10,20,0.98);backdrop-filter:blur(30px);border:1px solid rgba(255,255,255,0.2);border-radius:20px;padding:32px 48px;max-width:500px;width:90%;text-align:center;box-shadow:0 30px 80px rgba(0,0,0,0.9),0 0 100px rgba(139,61,255,0.4);animation:toastPop 0.5s cubic-bezier(0.34,1.56,0.64,1) both;display:none}
    .toast.show{display:block}
    .toast.error{border-color:rgba(255,107,107,0.5)}
    .toast.success{border-color:rgba(74,222,128,0.5)}
    .toast-icon{font-size:56px;margin-bottom:16px;animation:iconBounce 0.6s ease}
    .toast-message{font-size:17px;line-height:1.6;margin-bottom:20px}
    .toast-close{padding:12px 32px;background:linear-gradient(135deg,var(--accent),var(--accent-light));border:none;border-radius:12px;color:#fff;font-size:16px;font-weight:600;cursor:pointer;transition:all 0.3s}
    .toast-close:hover{transform:translateY(-2px);box-shadow:0 12px 32px rgba(139,61,255,0.5)}
    @keyframes toastPop{from{opacity:0;transform:translate(-50%,-50%) scale(0.7)}to{opacity:1;transform:translate(-50%,-50%) scale(1)}}
    @keyframes iconBounce{0%,100%{transform:translateY(0)}50%{transform:translateY(-10px)}}
  </style>
</head>
<body>
  <div class="bg"></div>
  <div class="orbs">
    <div class="orb orb1"></div>
    <div class="orb orb2"></div>
  </div>
  <div class="stars" id="stars"></div>
  <div class="notes" id="notes"></div>

  <div class="container">
    <div class="auth-side">
      <div class="card">
        <div class="logo">
          <div class="logo-icon">ðŸŽµ</div>
          <h1>MusicsAura</h1>
          <p class="subtitle">Your music, your vibe</p>
        </div>

        <div class="tabs">
          <button class="tab active" data-tab="login">Login</button>
          <button class="tab" data-tab="signup">Sign Up</button>
        </div>

        <!-- Login Form -->
        <div class="form-section active" id="login-section">
          <form id="login-form">
            <div class="form-row">
              <label>Email</label>
              <div class="input-wrap">
                <input type="email" id="login-email" placeholder="you@example.com" required>
                <span class="icon material-icons">email</span>
              </div>
            </div>
            <div class="form-row">
              <label>Password</label>
              <div class="input-wrap">
                <input type="password" id="login-pass" placeholder="Enter password" required>
                <span class="icon material-icons">lock</span>
              </div>
            </div>
            <a href="#" class="forgot-link" id="forgot-pass">Forgot password?</a>
            <button type="submit" class="btn btn-primary">Login</button>
          </form>

          <div class="divider">OR</div>
          <button class="google-btn" id="google-login">
            <img src="https://www.google.com/favicon.ico" alt="">
            Continue with Google
          </button>

          <div id="login-msg" class="msg" style="display:none"></div>
        </div>

        <!-- Signup Form -->
        <div class="form-section" id="signup-section">
          <form id="signup-form">
            <div class="form-row">
              <label>Username</label>
              <div class="input-wrap">
                <input type="text" id="signup-username" placeholder="Choose username" required>
                <span class="icon material-icons">person</span>
              </div>
            </div>
            <div class="form-row">
              <label>Email</label>
              <div class="input-wrap">
                <input type="email" id="signup-email" placeholder="you@example.com" required>
                <span class="icon material-icons">email</span>
              </div>
            </div>
            <div class="form-row">
              <label>Password</label>
              <div class="input-wrap">
                <input type="password" id="signup-pass" placeholder="At least 6 characters" required>
                <span class="icon material-icons">lock</span>
              </div>
            </div>
            <button type="submit" class="btn btn-primary">Create Account</button>
          </form>

          <div class="divider">OR</div>
          <button class="google-btn" id="google-signup">
            <img src="https://www.google.com/favicon.ico" alt="">
            Sign up with Google
          </button>

          <div id="signup-msg" class="msg" style="display:none"></div>
        </div>
      </div>
    </div>

    <div class="welcome">
      <h2>Welcome to MusicsAura</h2>
      <p>
        Discover millions of songs, create personalized playlists, and enjoy high-quality streaming. 
        <strong>MusicsAura</strong> brings you seamless playback across all devices. 
        Join the music revolution today!
      </p>
    </div>
  </div>

  <div class="loader" id="loader">
    <div class="bars">
      <div class="bar"></div>
      <div class="bar"></div>
      <div class="bar"></div>
      <div class="bar"></div>
    </div>
    <div class="loader-text">Authenticating...</div>
  </div>

  <!-- Toast Notification -->
  <div class="toast" id="toast">
    <div class="toast-icon" id="toast-icon"></div>
    <div class="toast-message" id="toast-message"></div>
    <button class="toast-close" onclick="document.getElementById('toast').classList.remove('show')">Got it</button>
  </div>

  <script type="module">
    import { initializeApp } from "firebase/app";
    import { getAuth, signInWithPopup, GoogleAuthProvider, signInWithEmailAndPassword, createUserWithEmailAndPassword, sendEmailVerification, sendPasswordResetEmail, onAuthStateChanged } from "firebase/auth";
    import { getFirestore, doc, setDoc, getDoc, updateDoc, serverTimestamp } from "firebase/firestore";

    const firebaseConfig = {
      apiKey: "AIzaSyClIhXAaTVmlqhEPxU49C9w9fDkUag-1eQ",
      authDomain: "vibe-tunes.firebaseapp.com",
      projectId: "vibe-tunes",
      storageBucket: "vibe-tunes.firebasestorage.app",
      messagingSenderId: "792892627539",
      appId: "1:792892627539:web:69817da08d2d4741a404a6",
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);
    const provider = new GoogleAuthProvider();

    // Generate 100 stars
    const starsEl = document.getElementById('stars');
    for(let i=0; i<100; i++){
      const star = document.createElement('div');
      star.className = 'star';
      star.style.left = Math.random() * 100 + '%';
      star.style.top = Math.random() * 100 + '%';
      star.style.animationDelay = Math.random() * 3 + 's';
      star.style.animationDuration = (Math.random() * 2 + 2) + 's';
      starsEl.appendChild(star);
    }

    // Generate floating notes
    const notesEl = document.getElementById('notes');
    const noteSymbols = ['â™«', 'â™ª', 'â™¬', 'â™©', 'â™­', 'â™®', 'ð„ž'];
    for(let i=0; i<30; i++){
      const note = document.createElement('div');
      note.className = 'note';
      note.textContent = noteSymbols[Math.floor(Math.random() * noteSymbols.length)];
      note.style.left = Math.random() * 100 + '%';
      note.style.animationDelay = Math.random() * 15 + 's';
      note.style.animationDuration = (Math.random() * 10 + 10) + 's';
      notesEl.appendChild(note);
    }

    // Tab switching
    document.querySelectorAll('.tab').forEach(tab => {
      tab.addEventListener('click', () => {
        const target = tab.dataset.tab;
        document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
        tab.classList.add('active');
        document.querySelectorAll('.form-section').forEach(s => s.classList.remove('active'));
        document.getElementById(target + '-section').classList.add('active');
      });
    });

    const loader = document.getElementById('loader');
    const toast = document.getElementById('toast');
    const toastIcon = document.getElementById('toast-icon');
    const toastMessage = document.getElementById('toast-message');
    
    function showLoader(){ loader.classList.add('active'); }
    function hideLoader(){ loader.classList.remove('active'); }
    
    function showToast(message, type){
      toast.className = `toast show ${type}`;
      toastIcon.textContent = type === 'error' ? 'âŒ' : 'âœ…';
      toastMessage.textContent = message;
      setTimeout(() => toast.classList.remove('show'), 8000);
    }
    
    function showMsg(el, text, type){
      el.textContent = text;
      el.className = `msg ${type}`;
      el.style.display = 'block';
      setTimeout(() => el.style.display = 'none', 5000);
    }

    async function upsertUser(user, extra = {}){
      const ref = doc(db, "users", user.uid);
      const snap = await getDoc(ref);
      if(!snap.exists()){
        await setDoc(ref, {
          displayName: extra.displayName || user.displayName || "User",
          email: user.email,
          photoURL: user.photoURL || "",
          minutesListened: 0,
          songsPlayed: 0,
          isAdmin: user.email === 'prabhakararyan2007@gmail.com',
          country: "IN",
          xHandle: "@DesiDiamondSave",
          createdAt: serverTimestamp(),
          lastLogin: serverTimestamp()
        });
      } else {
        await updateDoc(ref, { lastLogin: serverTimestamp() });
      }
    }

    // Google Auth
    document.getElementById('google-login').addEventListener('click', async () => {
      showLoader();
      try{
        const result = await signInWithPopup(auth, provider);
        await upsertUser(result.user);
        hideLoader();
        showToast('Login successful! Redirecting...', 'success');
        setTimeout(() => {
          location.href = result.user.email === 'prabhakararyan2007@gmail.com' ? 'admin-dashboard.html' : 'index.html';
        }, 1500);
      }catch(e){
        hideLoader();
        showToast('Google login failed. Please try again.', 'error');
      }
    });

    document.getElementById('google-signup').addEventListener('click', async () => {
      showLoader();
      try{
        const result = await signInWithPopup(auth, provider);
        await upsertUser(result.user);
        hideLoader();
        showToast('Account created successfully! Redirecting...', 'success');
        setTimeout(() => {
          location.href = result.user.email === 'prabhakararyan2007@gmail.com' ? 'admin-dashboard.html' : 'index.html';
        }, 1500);
      }catch(e){
        hideLoader();
        showToast('Google signup failed. Please try again.', 'error');
      }
    });

    // Email Login
    document.getElementById('login-form').addEventListener('submit', async (e) => {
      e.preventDefault();
      showLoader();
      const email = document.getElementById('login-email').value.trim();
      const pass = document.getElementById('login-pass').value;
      try{
        const cred = await signInWithEmailAndPassword(auth, email, pass);
        if(!cred.user.emailVerified){
          hideLoader();
          showToast('Please verify your email first. Check your inbox for the verification link.', 'error');
          return;
        }
        await upsertUser(cred.user);
        hideLoader();
        showToast('Login successful! Welcome back.', 'success');
        setTimeout(() => {
          location.href = cred.user.email === 'prabhakararyan2007@gmail.com' ? 'admin-dashboard.html' : 'index.html';
        }, 1500);
      }catch(e){
        hideLoader();
        console.error('Login error:', e);
        let errorMsg = '';
        if(e.code === 'auth/user-not-found'){
          errorMsg = 'No account found with this email. Please sign up first or check your email address.';
        } else if(e.code === 'auth/wrong-password'){
          errorMsg = 'Incorrect password. Please try again or click "Forgot password?" to reset it.';
        } else if(e.code === 'auth/invalid-email'){
          errorMsg = 'Invalid email address. Please enter a valid email.';
        } else if(e.code === 'auth/too-many-requests'){
          errorMsg = 'Too many failed login attempts. Please wait a few minutes or reset your password.';
        } else if(e.code === 'auth/invalid-credential' || e.code === 'auth/invalid-login-credentials'){
          errorMsg = 'Incorrect email or password. Please check your credentials and try again, or click "Forgot password?" to reset.';
        } else {
          errorMsg = 'Login failed. Please check your email and password, then try again.';
        }
        showToast(errorMsg, 'error');
      }
    });

    // Email Signup
    document.getElementById('signup-form').addEventListener('submit', async (e) => {
      e.preventDefault();
      showLoader();
      const username = document.getElementById('signup-username').value.trim();
      const email = document.getElementById('signup-email').value.trim();
      const pass = document.getElementById('signup-pass').value;
      
      if(username.length < 3){
        hideLoader();
        showToast('Username must be at least 3 characters long.', 'error');
        return;
      }
      if(pass.length < 6){
        hideLoader();
        showToast('Password must be at least 6 characters long.', 'error');
        return;
      }
      
      try{
        const cred = await createUserWithEmailAndPassword(auth, email, pass);
        await sendEmailVerification(cred.user);
        await upsertUser(cred.user, { displayName: username });
        hideLoader();
        showToast('Account created successfully! Please check your email to verify your account.', 'success');
        setTimeout(() => {
          document.querySelector('[data-tab="login"]').click();
        }, 2500);
      }catch(e){
        hideLoader();
        let errorMsg = '';
        if(e.code === 'auth/email-already-in-use'){
          errorMsg = 'This email is already registered. Please login instead or use a different email.';
        } else if(e.code === 'auth/invalid-email'){
          errorMsg = 'Invalid email address. Please enter a valid email.';
        } else if(e.code === 'auth/weak-password'){
          errorMsg = 'Password is too weak. Please use at least 6 characters with letters and numbers.';
        } else {
          errorMsg = 'Signup failed. Please try again with a different email address.';
        }
        showToast(errorMsg, 'error');
      }
    });

    // Forgot Password
    document.getElementById('forgot-pass').addEventListener('click', async (e) => {
      e.preventDefault();
      const email = document.getElementById('login-email').value.trim();
      
      if(!email){
        showToast('Please enter your email address first, then click "Forgot password?"', 'error');
        return;
      }
      
      if(!email.includes('@')){
        showToast('Please enter a valid email address.', 'error');
        return;
      }
      
      showLoader();
      try{
        await sendPasswordResetEmail(auth, email);
        hideLoader();
        showToast('Password reset email sent successfully! Check your inbox and follow the instructions.', 'success');
      }catch(e){
        hideLoader();
        let errorMsg = '';
        if(e.code === 'auth/user-not-found'){
          errorMsg = 'No account found with this email address. Please check your email or sign up.';
        } else if(e.code === 'auth/invalid-email'){
          errorMsg = 'Invalid email address. Please enter a valid email.';
        } else {
          errorMsg = 'Failed to send password reset email. Please try again.';
        }
        showToast(errorMsg, 'error');
      }
    });

    // Auto redirect if logged in
    onAuthStateChanged(auth, user => {
      if(user && (user.emailVerified || user.providerData.some(p => p.providerId === 'google.com'))){
        upsertUser(user).catch(console.error);
        setTimeout(() => {
          location.href = user.email === 'prabhakararyan2007@gmail.com' ? 'admin-dashboard.html' : 'index.html';
        }, 800);
      }
    });
  </script>
</body>
</html>