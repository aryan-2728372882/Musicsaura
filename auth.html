<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>MelodyTunes — Login</title>

  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">

  <style>
    :root{
      --bg-left:#0a0a14; --bg-right:#1a0b3d; --accent:#8b3dff; --accent-glow:rgba(139,61,255,0.5);
      --glass:rgba(255,255,255,0.08); --glass-border:rgba(255,255,255,0.12);
      --text:#e2e8f0; --muted:rgba(203,213,225,0.9); --danger:#ff6b6b; --success:#4ade80;
      --max-w:420px; --transition:0.6s cubic-bezier(0.175,0.885,0.32,1.275);
    }
    *{box-sizing:border-box;margin:0;padding:0}
    html,body{height:100%;font-family:'Inter',system-ui,Segoe UI,Roboto,Helvetica,Arial;background:var(--bg-left);color:var(--text);overflow:hidden}
    
    /* Diagonal split with pulsing glow */
    .split-bg{position:absolute;inset:0;background:linear-gradient(135deg,var(--bg-left) 50%,var(--bg-right) 50%);z-index:0;animation:bgFlow 8s ease-in-out infinite, bgPulse 3s ease-in-out infinite}
    @keyframes bgFlow{0%,100%{background-position:0% 50%}50%{background-position:100% 50%}}
    @keyframes bgPulse{0%,100%{box-shadow:0 0 20px rgba(139,61,255,0)}50%{box-shadow:0 0 60px rgba(139,61,255,0.4)}}

    /* Music notes + falling stars (top to bottom) */
    .particles{position:absolute;inset:0;z-index:1;pointer-events:none}
    .particle{position:absolute;animation:fallDown 12s linear infinite}
    .particle.note{font-size:18px;color:var(--accent);opacity:0.7}
    .particle.star{width:3px;height:3px;background:#fff;border-radius:50%;box-shadow:0 0 8px #fff}
    .particle.star::before{content:'';position:absolute;top:-30px;left:-1px;width:2px;height:40px;background:linear-gradient(to bottom,#fff,transparent);opacity:0.8}
    @keyframes fallDown{
      0%{transform:translateY(-100px) rotate(0deg);opacity:0}
      10%{opacity:1}
      90%{opacity:1}
      100%{transform:translateY(calc(100vh + 100px)) rotate(360deg);opacity:0}
    }

    /* Container */
    .container{position:relative;z-index:10;display:grid;grid-template-columns:1fr 1fr;min-height:100vh;max-width:1200px;margin:auto;padding:20px;gap:40px;align-items:center}
    @media (max-width:900px){.container{grid-template-columns:1fr;padding:20px 15px;gap:30px}}
    @media (max-width:600px){.container{display:flex;flex-direction:column;justify-content:center;gap:20px}}

    /* Left: Auth Slider */
    .auth-side{max-width:var(--max-w);margin:auto;position:relative;overflow:hidden}
    .slider{position:relative;width:100%;height:auto;min-height:520px;transition:transform var(--transition)}
    .panel{width:100%;position:absolute;top:0;left:0;opacity:0;visibility:hidden;transition:all var(--transition);padding:36px 32px}
    .panel.active{opacity:1;visibility:visible;transform:translateX(0);position:relative}
    .panel.prev{transform:translateX(-100%)}
    .panel.next{transform:translateX(100%)}

    .card{background:var(--glass);border-radius:24px;border:1px solid var(--glass-border);backdrop-filter:blur(20px);box-shadow:0 40px 80px rgba(0,0,0,0.7),inset 0 0 40px rgba(255,255,255,0.06);animation:cardFloat 3s ease-in-out infinite, cardGlow 2s ease-in-out infinite}
    @keyframes cardFloat{0%,100%{transform:translateY(0) rotate(0deg)}50%{transform:translateY(-12px) rotate(1deg)}}
    @keyframes cardGlow{0%,100%{box-shadow:0 40px 80px rgba(0,0,0,0.7),inset 0 0 40px rgba(255,255,255,0.06)}50%{box-shadow:0 40px 100px rgba(139,61,255,0.4),inset 0 0 50px rgba(139,61,255,0.1)}}

    h1{font-size:30px;font-weight:700;margin-bottom:24px;color:#fff;text-align:center;background:linear-gradient(135deg,var(--accent),#a166ff);-webkit-background-clip:text;-webkit-text-fill-color:transparent;animation:titleGlow 1.5s ease-in-out infinite, titleBounce 2s ease-in-out infinite}
    @keyframes titleGlow{0%,100%{filter:drop-shadow(0 0 10px var(--accent-glow))}50%{filter:drop-shadow(0 0 30px var(--accent-glow))}}
    @keyframes titleBounce{0%,100%{transform:scale(1)}50%{transform:scale(1.05)}}

    .form-row{margin-bottom:18px;position:relative}
    label{font-size:14px;color:var(--muted);display:block;margin-bottom:8px;animation:fadeIn 0.8s ease both}
    .input-wrap{position:relative}
    input{width:100%;padding:14px 16px 14px 44px;border-radius:16px;border:1px solid rgba(255,255,255,0.18);background:rgba(255,255,255,0.06);color:#fff;font-size:16px;outline:none;transition:all .3s;box-shadow:inset 0 2px 8px rgba(0,0,0,0.15)}
    input:focus{border-color:var(--accent);box-shadow:0 0 0 4px var(--accent-glow),inset 0 2px 8px rgba(0,0,0,0.15);transform:scale(1.03);animation:inputGlow 1s ease-in-out}
    @keyframes inputGlow{0%,100%{box-shadow:0 0 0 4px var(--accent-glow),inset 0 2px 8px rgba(0,0,0,0.15)}50%{box-shadow:0 0 0 8px var(--accent-glow),inset 0 2px 8px rgba(0,0,0,0.15)}}
    input::placeholder{color:rgba(255,255,255,0.55)}
    .icon{position:absolute;left:14px;top:50%;transform:translateY(-50%);color:rgba(255,255,255,0.6);font-size:20px;animation:iconPulse 1.5s ease-in-out infinite}
    @keyframes iconPulse{0%,100%{opacity:0.6;transform:translateY(-50%) scale(1)}50%{opacity:1;transform:translateY(-50%) scale(1.1)}}

    .divider{position:relative;text-align:center;margin:22px 0;color:var(--muted);font-size:14px}
    .divider::before{content:'';position:absolute;top:50%;left:0;width:100%;height:1px;background:rgba(255,255,255,0.15);z-index:0;animation:dividerPulse 2s ease-in-out infinite}
    .divider span{position:relative;background:var(--bg-left);padding:0 14px;z-index:1}
    @keyframes dividerPulse{0%,100%{opacity:0.5}50%{opacity:1}}

    .google-btn{display:flex;align-items:center;justify-content:center;width:100%;padding:14px;border-radius:16px;border:1px solid rgba(255,255,255,0.2);background:rgba(255,255,255,0.08);color:#fff;font-weight:600;font-size:16px;margin-top:8px;cursor:pointer;transition:all .3s;box-shadow:0 6px 20px rgba(0,0,0,0.25);animation:btnPulse 1.8s ease-in-out infinite}
    .google-btn:hover{transform:translateY(-3px) scale(1.02);box-shadow:0 12px 32px rgba(139,61,255,0.4);border-color:var(--accent)}
    .google-btn img{width:22px;height:22px;margin-right:10px}
    @keyframes btnPulse{0%,100%{box-shadow:0 6px 20px rgba(0,0,0,0.25)}50%{box-shadow:0 10px 28px rgba(139,61,255,0.35)}}

    .btn{display:block;width:100%;padding:16px;border-radius:18px;border:0;cursor:pointer;background:linear-gradient(135deg,var(--accent),#a166ff);color:#fff;font-weight:600;font-size:17px;margin-top:18px;box-shadow:0 12px 32px rgba(139,61,255,0.3);transition:all .3s;position:relative;overflow:hidden;animation:mainBtnPulse 2s ease-in-out infinite}
    .btn:hover{transform:translateY(-3px) scale(1.02);box-shadow:0 16px 40px rgba(139,61,255,0.45)}
    .btn:active{transform:translateY(0)}
    .btn::before{content:'';position:absolute;inset:0;background:linear-gradient(135deg,rgba(255,255,255,0.25),transparent);opacity:0;transition:opacity .3s}
    .btn:hover::before{opacity:1}
    @keyframes mainBtnPulse{0%,100%{box-shadow:0 12px 32px rgba(139,61,255,0.3)}50%{box-shadow:0 16px 40px rgba(139,61,255,0.45)}}

    .link{color:var(--accent);background:none;border:none;cursor:pointer;font-size:15px;margin-top:18px;display:block;text-align:center;transition:all .3s;animation:fadeIn 1s ease both}
    .link:hover{color:#fff;transform:translateX(3px) scale(1.05)}

    /* Tab dots */
    .tab-dots{display:flex;justify-content:center;gap:12px;margin-top:24px}
    .dot{width:14px;height:14px;border-radius:50%;background:rgba(255,255,255,0.25);cursor:pointer;transition:all .3s;position:relative;animation:dotFloat 3s ease-in-out infinite}
    .dot.active{background:var(--accent);transform:scale(1.3);box-shadow:0 0 16px var(--accent-glow)}
    .dot::after{content:'';position:absolute;inset:0;border-radius:50%;background:conic-gradient(var(--accent),transparent);opacity:0;transition:opacity .3s}
    .dot.active::after{opacity:1;animation:dotSpin 0.8s linear infinite}
    @keyframes dotFloat{0%,100%{transform:translateY(0)}50%{transform:translateY(-4px)}}
    @keyframes dotSpin{0%{transform:rotate(0deg)}100%{transform:rotate(360deg)}}

    /* Right: Welcome */
    .welcome-side{color:#fff;padding:0 20px;display:flex;flex-direction:column;justify-content:center;align-items:flex-start}
    @media (max-width:600px){.welcome-side{display:none}}
    .welcome-title{font-size:52px;font-weight:700;margin-bottom:18px;color:#fff;animation:fadeInDown 1s ease both, titleBounce 2.5s ease-in-out infinite}
    .welcome-desc{font-size:19px;line-height:1.7;color:rgba(255,255,255,0.88);max-width:460px;animation:fadeInUp 1s ease both;animation-delay:0.4s}
    .welcome-desc strong{color:#fff;font-weight:600}
    @keyframes fadeInDown{from{opacity:0;transform:translateY(-40px)}to{opacity:1;transform:translateY(0)}}
    @keyframes fadeInUp{from{opacity:0;transform:translateY(30px)}to{opacity:1;transform:translateY(0)}}

    /* Loading overlay */
    #loader-overlay{position:fixed;inset:0;background:rgba(8,8,18,0.96);backdrop-filter:blur(16px);z-index:999;display:flex;flex-direction:column;align-items:center;justify-content:center;opacity:0;visibility:hidden;transition:all .5s}
    #loader-overlay.active{opacity:1;visibility:visible}
    .music-loader{width:80px;height:80px;position:relative;margin-bottom:24px;display:flex;gap:6px}
    .music-bar{width:10px;height:100%;background:var(--accent);border-radius:6px;animation:musicPulse 1.2s ease-in-out infinite}
    .music-bar:nth-child(1){animation-delay:0s}
    .music-bar:nth-child(2){animation-delay:0.1s}
    .music-bar:nth-child(3){animation-delay:0.2s}
    .music-bar:nth-child(4){animation-delay:0.3s}
    @keyframes musicPulse{0%,100%{height:30%;transform:scaleY(1)}50%{height:100%;transform:scaleY(1.3)}}

    .loader-text{font-size:17px;color:var(--muted);letter-spacing:0.8px;animation:loaderPulse 1.3s ease-in-out infinite}
    @keyframes loaderPulse{0%,100%{opacity:0.7}50%{opacity:1}}

    /* Ripple */
    .ripple{position:absolute;border-radius:50%;background:rgba(255,255,255,0.4);transform:scale(0);animation:rippleAnim 0.6s ease-out;pointer-events:none}
    @keyframes rippleAnim{to{transform:scale(5);opacity:0}}

    /* Messages */
    .msg{margin-top:14px;text-align:center;font-size:15px}
    .error{color:var(--danger);animation:shake 0.4s ease}
    .success{color:var(--success);background:rgba(74,222,128,0.2);padding:12px 16px;border-radius:14px;animation:popIn 0.5s cubic-bezier(0.175,0.885,0.32,1.275)}
    @keyframes shake{0%,100%{transform:translateX(0)}25%,75%{transform:translateX(-6px)}50%{transform:translateX(6px)}}
    @keyframes popIn{0%{transform:scale(0.6);opacity:0}100%{transform:scale(1);opacity:1}}
  </style>
</head>
<body>
  <div class="split-bg"></div>
  <div class="particles" id="particles"></div>

  <div class="container">
    <!-- Left: Auth Slider -->
    <div class="auth-side">
      <div class="slider" id="slider">
        <!-- Login Panel -->
        <div class="panel active card" id="login-panel">
          <h1>Login</h1>
          <form id="login-form">
            <div class="form-row">
              <label for="login-username">Username</label>
              <div class="input-wrap">
                <span class="icon material-icons">person</span>
                <input id="login-username" type="text" placeholder="Enter username" autocomplete="username" required>
              </div>
            </div>

            <div class="form-row">
              <label for="login-password">Password</label>
              <div class="input-wrap">
                <span class="icon material-icons">lock</span>
                <input id="login-password" type="password" placeholder="Enter password" autocomplete="current-password" required>
              </div>
            </div>

            <button type="submit" class="btn ripple-btn">Login</button>

            <div class="divider">OR</div>
            <button type="button" class="google-btn ripple-btn" id="google-login">
              <img src="https://www.google.com/favicon.ico" alt="Google">
              Continue with Google
            </button>

            <button type="button" class="link" id="to-signup">Don't have an account? Sign Up</button>
          </form>
          <div id="login-msg" class="msg" aria-live="polite"></div>
        </div>

        <!-- Signup Panel -->
        <div class="panel card" id="signup-panel">
          <h1>Sign Up</h1>
          <form id="signup-form">
            <div class="form-row">
              <label for="signup-username">Username</label>
              <div class="input-wrap">
                <span class="icon material-icons">person_add</span>
                <input id="signup-username" type="text" placeholder="Choose username" autocomplete="username" required>
              </div>
            </div>

            <div class="form-row">
              <label for="signup-email">Email</label>
              <div class="input-wrap">
                <span class="icon material-icons">email</span>
                <input id="signup-email" type="email" placeholder="you@example.com" autocomplete="email" required>
              </div>
            </div>

            <div class="form-row">
              <label for="signup-password">Password</label>
              <div class="input-wrap">
                <span class="icon material-icons">lock</span>
                <input id="signup-password" type="password" placeholder="At least 6 chars" autocomplete="new-password" required>
              </div>
            </div>

            <button type="submit" class="btn ripple-btn">Create Account</button>

            <div class="divider">OR</div>
            <button type="button" class="google-btn ripple-btn" id="google-signup">
              <img src="https://www.google.com/favicon.ico" alt="Google">
              Sign Up with Google
            </button>

            <button type="button" class="link" id="to-login">Already have an account? Login</button>
          </form>
          <div id="signup-msg" class="msg" aria-live="polite"></div>
        </div>
      </div>

      <!-- Tab Dots -->
      <div class="tab-dots">
        <div class="dot active" data-panel="login"></div>
        <div class="dot" data-panel="signup"></div>
      </div>
    </div>

    <!-- Right: Welcome -->
    <div class="welcome-side">
      <h2 class="welcome-title">WELCOME BACK!</h2>
      <p class="welcome-desc">
        <strong>Welcome to MelodyTunes</strong> — your ultimate music playing website. 
        Discover millions of songs, create playlists, and enjoy high-quality streaming. 
        Dive into personalized recommendations, artist radios, and seamless playback across devices. 
        Join the music revolution today!
      </p>
    </div>
  </div>

  <!-- Loading Overlay -->
  <div id="loader-overlay">
    <div class="music-loader">
      <div class="music-bar"></div>
      <div class="music-bar"></div>
      <div class="music-bar"></div>
      <div class="music-bar"></div>
    </div>
    <div class="loader-text">Authenticating...</div>
  </div>

  <!-- Firebase SDKs -->
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>

  <script>
    // Firebase Config
    const firebaseConfig = {
      apiKey: "AIzaSyClIhXAaTVmlqhEPxU49C9w9fDkUag-1eQ",
      authDomain: "vibe-tunes.firebaseapp.com",
      databaseURL: "https://vibe-tunes-default-rtdb.asia-southeast1.firebasedatabase.app",
      projectId: "vibe-tunes",
      storageBucket: "vibe-tunes.firebasestorage.app",
      messagingSenderId: "792892627539",
      appId: "1:792892627539:web:69817da08d2d4741a404a6",
    };
    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.firestore();
    const googleProvider = new firebase.auth.GoogleAuthProvider();

    // Elements
    const loginPanel = document.getElementById('login-panel');
    const signupPanel = document.getElementById('signup-panel');
    const loginForm = document.getElementById('login-form');
    const signupForm = document.getElementById('signup-form');
    const loginMsg = document.getElementById('login-msg');
    const signupMsg = document.getElementById('signup-msg');
    const loader = document.getElementById('loader-overlay');
    const dots = document.querySelectorAll('.dot');
    const toSignup = document.getElementById('to-signup');
    const toLogin = document.getElementById('to-login');
    const googleLogin = document.getElementById('google-login');
    const googleSignup = document.getElementById('google-signup');
    const particlesContainer = document.getElementById('particles');

    // Music notes symbols
    const notes = ['♫', '♪', '♬', '♩', '♭', '♮'];

    // Generate 60 falling particles (40 stars, 20 notes)
    for(let i = 0; i < 60; i++){
      const p = document.createElement('div');
      p.className = 'particle';
      const isNote = i < 20;
      p.className += isNote ? ' note' : ' star';
      p.textContent = isNote ? notes[Math.floor(Math.random() * notes.length)] : '';
      p.style.left = Math.random() * 100 + '%';
      p.style.animationDelay = Math.random() * 10 + 's';
      p.style.animationDuration = (Math.random() * 8 + 8) + 's';
      particlesContainer.appendChild(p);
    }

    // Current panel
    let current = 'login';

    // Switch panel
    function switchPanel(target){
      if(current === target) return;
      current = target;
      loginPanel.classList.toggle('active', target === 'login');
      loginPanel.classList.toggle('prev', target === 'signup');
      loginPanel.classList.toggle('next', target === 'login');
      signupPanel.classList.toggle('active', target === 'signup');
      signupPanel.classList.toggle('prev', target === 'login');
      signupPanel.classList.toggle('next', target === 'signup');
      dots.forEach(d => d.classList.toggle('active', d.dataset.panel === target));
      loginMsg.innerHTML = signupMsg.innerHTML = '';
    }

    // Events
    toSignup.addEventListener('click', () => switchPanel('signup'));
    toLogin.addEventListener('click', () => switchPanel('login'));
    dots.forEach(dot => dot.addEventListener('click', () => switchPanel(dot.dataset.panel)));

    // Ripple
    document.querySelectorAll('.ripple-btn').forEach(btn => {
      btn.addEventListener('click', function(e){
        const ripple = document.createElement('span');
        const rect = btn.getBoundingClientRect();
        const size = Math.max(rect.width, rect.height);
        const x = e.clientX - rect.left - size/2;
        const y = e.clientY - rect.top - size/2;
        ripple.classList.add('ripple');
        ripple.style.width = ripple.style.height = size + 'px';
        ripple.style.left = x + 'px';
        ripple.style.top = y + 'px';
        btn.appendChild(ripple);
        setTimeout(() => ripple.remove(), 600);
      });
    });

    // Loader
    function showLoader(){ loader.classList.add('active'); }
    function hideLoader(){ setTimeout(() => loader.classList.remove('active'), 500); }

    // Messages
    function showSuccess(container, text){
      container.innerHTML = `<div class="success">${text}</div>`;
      setTimeout(() => container.innerHTML = '', 3000);
    }
    function showError(container, text){
      container.innerHTML = `<div class="error">${text}</div>`;
      setTimeout(() => container.innerHTML = '', 5000);
    }

    // User doc
    async function upsertUserDoc(user, additional={}){
      const ref = db.collection('users').doc(user.uid);
      const snap = await ref.get();
      if(!snap.exists){
        await ref.set({
          displayName: additional.displayName || user.displayName || user.email.split('@')[0],
          email: user.email || '',
          photoURL: user.photoURL || '',
          minutesListened: 0,
          songsPlayed: 0,
          isAdmin: user.email === 'prabhakararyan2007@gmail.com',
          createdAt: firebase.firestore.FieldValue.serverTimestamp(),
          lastLogin: firebase.firestore.FieldValue.serverTimestamp(),
          ...additional
        });
      } else {
        await ref.update({ lastLogin: firebase.firestore.FieldValue.serverTimestamp() });
      }
    }

    // Google Auth
    async function googleAuth(isSignup = false){
      showLoader();
      try{
        await auth.setPersistence(firebase.auth.Auth.Persistence.LOCAL);
        const result = await auth.signInWithPopup(googleProvider);
        const user = result.user;
        await upsertUserDoc(user, { displayName: user.displayName || user.email.split('@')[0] });
        hideLoader();
        showSuccess(isSignup ? signupMsg : loginMsg, 'Google login successful — redirecting…');
        setTimeout(() => location.href = user.email === 'prabhakararyan2007@gmail.com' ? 'admin-dashboard.html' : 'index.html', 1000);
      }catch(err){
        hideLoader();
        showError(isSignup ? signupMsg : loginMsg, err.message || 'Google auth failed');
      }
    }
    googleLogin.addEventListener('click', () => googleAuth(false));
    googleSignup.addEventListener('click', () => googleAuth(true));

    // Login
    loginForm.addEventListener('submit', async (e) => {
      e.preventDefault();
      loginMsg.innerHTML = '';
      const username = document.getElementById('login-username').value.trim();
      const password = document.getElementById('login-password').value;
      if(!username || !password) return showError(loginMsg, 'Fill all fields');

      showLoader();
      try{
        const email = `${username}@melodytunes.com`;
        await auth.setPersistence(firebase.auth.Auth.Persistence.SESSION);
        const cred = await auth.signInWithEmailAndPassword(email, password);
        if(!cred.user.emailVerified){
          hideLoader(); showError(loginMsg, 'Email not verified. Check inbox.'); return;
        }
        await upsertUserDoc(cred.user);
        showSuccess(loginMsg, 'Login successful — redirecting…');
        setTimeout(() => { hideLoader(); location.href = cred.user.email === 'prabhakararyan2007@gmail.com' ? 'admin-dashboard.html' : 'index.html'; }, 1000);
      }catch(err){
        hideLoader(); showError(loginMsg, err.message || 'Login failed');
      }
    });

    // Signup
    signupForm.addEventListener('submit', async (e) => {
      e.preventDefault();
      signupMsg.innerHTML = '';
      const username = document.getElementById('signup-username').value.trim();
      const email = document.getElementById('signup-email').value.trim();
      const password = document.getElementById('signup-password').value;
      if(username.length < 3) return showError(signupMsg, 'Username must be 3+ chars');
      if(!email || !email.includes('@')) return showError(signupMsg, 'Valid email required');
      if(password.length < 6) return showError(signupMsg, 'Password must be 6+ chars');

      showLoader();
      try{
        await auth.setPersistence(firebase.auth.Auth.Persistence.LOCAL);
        const cred = await auth.createUserWithEmailAndPassword(email, password);
        await cred.user.sendEmailVerification();
        await upsertUserDoc(cred.user, { displayName: username });
        hideLoader(); showSuccess(signupMsg, 'Account created! Check your email.');
        setTimeout(() => switchPanel('login'), 1500);
      }catch(err){
        hideLoader(); showError(signupMsg, err.message || 'Signup failed');
      }
    });

    // Auto-redirect
    auth.onAuthStateChanged(user => {
      if(user && (user.emailVerified || user.providerData.some(p => p.providerId === 'google.com'))){
        upsertUserDoc(user).catch(()=>{});
        setTimeout(() => location.href = user.email === 'prabhakararyan2007@gmail.com' ? 'admin-dashboard.html' : 'index.html', 800);
      }
    });
  </script>
</body>
</html>